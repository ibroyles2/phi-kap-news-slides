<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Phi Kap News Slides</title>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">
		<link rel="stylesheet" href="css/custom.css">
		<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-background-color="white">
					<script>
						const dateObject = Date.now();
						const currentDate = new Date(dateObject).toISOString();
						const APIKey = "AIzaSyDHl44J_hE5kwLQwyP-IWtxl4zS2hgorwc";
						const CalendarID = "296lgns27im7bgtotmjaac7uko@group.calendar.google.com";
						const getURL = "https://www.googleapis.com/calendar/v3/calendars/" + CalendarID + "/events?key=" + APIKey + "&futureevents=true&timeMin=" + currentDate + "&singleEvents=true&orderBy=startTime";

						var xhr = new XMLHttpRequest();

						xhr.open('GET', getURL, true);
						xhr.send();
						
						xhr.onreadystatechange = processRequest;
							
						function processRequest(e) {
							if (xhr.readyState == 4 && xhr.status == 200) {
								var response = JSON.parse(xhr.responseText);
								extractTopEvents(response);
							}
						}

						function extractTopEvents(response) {
							var events = response.items;
							var currentEvents = [];
							const eventNumber = 5;

							for(i = 0; i < eventNumber; i++) {
								let event = {title: "", start: "", end: "", location: "", description: ""};

								event.title = events[i].summary;
								event = getTimes(events[i].start, events[i].end, event);
								
								event.location = events[i].location;
								if(event.location === undefined) {
									event.location = "<i>None Provided</i>";
								}

								event.description = events[i].description;
								if(event.description === undefined){
									event.description = "<i>None Provided</i>";
								}
								event.description = event.description.replace(new RegExp('\r?\n','g'), '<br />');

								currentEvents[i] = event;
							}

							console.log(currentEvents);
							sendToPage(currentEvents);

						}

						function getTimes(startObject, endObject, event) {
							let monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
							let start;
							let end;

							if(startObject.date != null) {
								start = startObject.date;
							} else {
								start = startObject.dateTime;
							}

							let startDateTime = new Date(start);
							event.start = monthNames[startDateTime.getMonth()];
							event.start = event.start + " " + startDateTime.getDate().toString();

							if(startObject.date != null) {
								
							} else {
								event.start = event.start + ", " + startDateTime.toLocaleTimeString('en-US', { timeStyle: 'short'});
							}

							if(endObject.date != null) {
								end = endObject.date;
							} else {
								end = endObject.dateTime;
							}

							let endDateTime = new Date(end);
							event.end = monthNames[endDateTime.getMonth()];
							event.end = event.end + " " + endDateTime.getDate().toString();

							if(endObject.date != null) {
								
							} else {
								event.end = event.end + ", " + endDateTime.toLocaleTimeString('en-US', { timeStyle: 'short'});
							}

							return event;
						}

						function sendToPage(eventList) {
							var htmlContent = "<div class=\"col\">";
							for(i = 0; i < eventList.length; i++) {
								if(i === 5) {
									htmlContent += "</div><div class=\"col\">"
								}
								htmlContent += "<div class=\"row row-striped\"><div class=\"col\"><h3 class=\"text-uppercase\"><strong>"; // opener
								htmlContent += eventList[i].title; // title
								htmlContent += "</strong></h3><ul class=\"list-inline\"><li class=\"list-inline-item\"><i class=\"fa fa-calendar-o\" aria-hidden=\"true\"></i>";
								htmlContent += " " + eventList[i].start + " - " + eventList[i].end;
								htmlContent += "</li><li class=\"list-inline-item\"><i class=\"fa fa-location-arrow\" aria-hidden=\"true\"></i>";
								htmlContent += " " + eventList[i].location;
								htmlContent += "</li></ul><p>" + eventList[i].description + "</p></div></div>"
							}
							htmlContent += "</div>"
							document.getElementById("card-calendar").innerHTML = htmlContent;
						}
					</script>
					<div class="calendar container-fluid" style="color: black" id="card-calendar">
					</div>
				</section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true },
				]
			});
		</script>
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	</body>
</html>
